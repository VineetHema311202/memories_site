<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Gallery</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #fff0f5;
      margin: 0;
      padding: 20px;
      text-align: center;
    }

    h1 {
      color: #d6336c;
      margin-bottom: 10px;
    }

    .gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 30px;
    }

    .gallery-item {
      width: 280px;
      height: 200px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 12px rgba(0,0,0,0.1);
      background: #fff;
      transition: transform 0.3s;
    }

    .gallery-item:hover {
      transform: scale(1.05);
    }

    .gallery-item img, .gallery-item video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .back-link {
      display: inline-block;
      margin-top: 20px;
      color: #a61e4d;
      text-decoration: none;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1 id="memory-title">Loading...</h1>
  <div class="gallery" id="gallery"></div>
  <a href="index.html" class="back-link">← Back to Memories</a>

  <script>
    const title = new URLSearchParams(window.location.search).get("title") || "Memories";
    document.getElementById("memory-title").textContent = title;

    const publicKey = "618cf797fcfca50d3a4a"; // Your Uploadcare public key
    const tag = title.replace(/\s+/g, '-'); // e.g., "Special Moments" → "Special-Moments"
    const gallery = document.getElementById("gallery");

    async function fetchImagesByTag(tag) {
      try {
        const response = await fetch(`https://api.uploadcare.com/files/?ordering=-datetime_uploaded&limit=100&tags=${tag}`, {
          headers: {
            "Content-Type": "application/json",
            "Accept": "application/vnd.uploadcare-v0.7+json",
            "Authorization": `Uploadcare.Simple ${publicKey}:`
          }
        });

        const data = await response.json();
        const files = data.results;

        if (!files.length) {
          gallery.innerHTML = `<p>No images found for "${title}".</p>`;
          return;
        }

        files.forEach(file => {
          const item = document.createElement("div");
          item.className = "gallery-item";

          if (file.mime_type.startsWith("image")) {
            item.innerHTML = `<img src="https://ucarecdn.com/${file.uuid}/-/preview/"/>`;
          } else if (file.mime_type.startsWith("video")) {
            item.innerHTML = `<video controls src="https://ucarecdn.com/${file.uuid}/" type="${file.mime_type}"></video>`;
          }

          gallery.appendChild(item);
        });

      } catch (error) {
        gallery.innerHTML = `<p>Error loading images: ${error.message}</p>`;
      }
    }

    fetchImagesByTag(tag);
  </script>
</body>
</html>
