<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Memory Gallery</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #f8f9fa;
      padding: 20px;
      text-align: center;
    }
    h1 {
      color: #c9184a;
    }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-top: 30px;
    }
    .gallery img, .gallery video {
      width: 100%;
      max-height: 300px;
      object-fit: cover;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    .back-btn {
      display: inline-block;
      margin-top: 20px;
      padding: 10px 20px;
      background: #c9184a;
      color: white;
      text-decoration: none;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <h1 id="galleryTitle">Memories</h1>
  <div class="gallery" id="galleryContainer">Loading...</div>
  <a class="back-btn" href="index.html">â¬… Back to Home</a>

  <script>
    const params = new URLSearchParams(window.location.search);
    const title = params.get("title") || "Memories";

    document.getElementById("galleryTitle").innerText = title;

    async function fetchImages() {
      const gallery = document.getElementById("galleryContainer");
      gallery.innerHTML = "Loading...";

      const secretKey = "50ee79a703af15ff4e1e"; // Will be replaced by Netlify env variable
      const tag = title;

      try {
        const response = await fetch(`https://api.uploadcare.com/files/?ordering=-datetime_uploaded&limit=100&tags=${tag}`, {
          headers: {
            "Authorization": "Uploadcare.Simple " + secretKey
          }
        });

        if (!response.ok) throw new Error("Uploadcare fetch failed");

        const data = await response.json();
        gallery.innerHTML = "";

        if (data.results.length === 0) {
          gallery.innerHTML = "No memories found for this folder.";
          return;
        }

        data.results.forEach(file => {
          const mime = file.mime_type;
          const url = `https://ucarecdn.com/${file.uuid}/`;

          if (mime.startsWith("image/")) {
            const img = document.createElement("img");
            img.src = url;
            gallery.appendChild(img);
          } else if (mime.startsWith("video/")) {
            const vid = document.createElement("video");
            vid.src = url;
            vid.controls = true;
            gallery.appendChild(vid);
          } else if (mime.startsWith("audio/")) {
            const audio = document.createElement("audio");
            audio.src = url;
            audio.controls = true;
            gallery.appendChild(audio);
          }
        });

      } catch (error) {
        console.error("Error fetching Uploadcare media:", error);
        gallery.innerHTML = "Failed to load media.";
      }
    }

    fetchImages();
  </script>
</body>
</html>
